# ConsoleChat (TCP)

<<<<<<< HEAD
Кроссплатформенный консольный чат (клиент/сервер) на C++ с хранением данных в SQLite.

## Возможности

- ✅ Регистрация и авторизация пользователей
- ✅ Общий чат (broadcast) и приватные сообщения
- ✅ История сообщений (общая и приватная)
- ✅ Список онлайн-пользователей
- ✅ Многопоточная обработка подключений
- ✅ Логирование действий в базу данных
- ✅ Кроссплатформенность (Windows, macOS, Linux)

## Архитектура проекта

```
src/
├── chat_server_tcp/           # Серверная часть
│   ├── Server.h/cpp          # Основной класс сервера
│   ├── Database.h/cpp        # Работа с SQLite базой
│   └── server_main.cpp       # Точка входа сервера
├── chat_client_tcp/          # Клиентская часть
│   ├── Client.h/cpp          # Основной класс клиента
│   └── client_main.cpp       # Точка входа клиента
├── Menu.cpp                  # Консольное меню клиента
├── common.cpp                # Общие утилиты и логирование
└── include/
    └── common.h              # Общие заголовки
```

## Зависимости

- **C++17+**
- **CMake 3.15+**
- **SQLite3**
  - macOS: `brew install sqlite`
  - Ubuntu/Debian: `sudo apt install libsqlite3-dev`
  - Windows: автоматически через vcpkg или вручную

## Установка и сборка

### Автоматическая сборка (рекомендуется)

Проект автоматически установит зависимости через соответствующие пакетные менеджеры:

```bash
# Клонирование репозитория
git clone <repo-url>
cd Console_chat_TCP

# Сборка проекта
cmake -B build -S . -DCMAKE_BUILD_TYPE=Release
cmake --build build --config Release
```

### Ручная установка зависимостей

**macOS:**
```bash
brew install sqlite
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install libsqlite3-dev build-essential
```

**Windows с vcpkg:**
```bash
vcpkg install sqlite3:x64-windows
cmake -B build -S . -DCMAKE_TOOLCHAIN_FILE="C:/vcpkg/scripts/buildsystems/vcpkg.cmake"
cmake --build build --config Release
```

## Запуск

### 1. Запуск сервера

```bash
# Перейдите в папку сборки
cd build

# Запустите сервер (в отдельном терминале)
./tcp_chat_server
```

**При первом запуске:**
- Создается база данных `tcp_chat.db`
- Автоматически регистрируется пользователь `admin` с паролем `admin123`

### 2. Запуск клиента

```bash
# В другом терминале
cd build
./tcp_chat_client
```

## Использование клиента

### Главное меню
```
╔══════════════════════════╗
║      ДОБРО ПОЖАЛОВАТЬ    ║
╠══════════════════════════╣
║ 1. Вход                  ║
║ 2. Регистрация           ║
║ 3. Выход                 ║
╚══════════════════════════╝
```

### Меню пользователя
```
╔══════════════════════════╗
║    МЕНЮ ПОЛЬЗОВАТЕЛЯ     ║
╠══════════════════════════╣
║ Пользователь: username   ║
╠══════════════════════════╣
║ 1. Приватный чат         ║
║ 2. Общий чат             ║
║ 3. История сообщений     ║
║ 4. Список пользователей  ║
║ 5. Выход                 ║
╚══════════════════════════╝
```

### Команды в чате

**В общем чате:**
- `/exit` - вернуться в меню
- `/history` - показать историю общего чата
- `/users` - список пользователей
- `/help` - показать команды
- `/quit` - выйти из приложения

**В приватном чате:**
- `/exit` - вернуться в меню
- `/history` - история переписки
- `/help` - показать команды

## Сетевая конфигурация

- **Сервер:** слушает порт `12345` на всех интерфейсах (`0.0.0.0`)
- **Клиент:** подключается к `127.0.0.1:12345` по умолчанию
- **Протокол:** TCP с текстовыми командами

## База данных

Сервер автоматически создает SQLite базу со следующими таблицами:
- `users` - зарегистрированные пользователи
- `messages` - все сообщения (общие и приватные)
- `logs` - логи действий сервера

## Частые проблемы и решения

### Ошибка компиляции: "Could NOT find SQLite3"
**Решение:** Убедитесь, что SQLite3 установлен в системе или используйте автоматическую установку через vcpkg.

### Русские символы отображаются неправильно (Windows)
**Решение:** Проект автоматически настраивает кодовую страницу UTF-8. Убедитесь, что используете современный терминал (Windows Terminal рекомендуется).

### Клиент не подключается к серверу
**Решение:**
1. Убедитесь, что сервер запущен
2. Проверьте брандмауэр
3. Убедитесь, что порт 12345 свободен

### Ошибка "Database.h included in client project"
**Решение:** Это архитектурная ошибка - клиент не должен включать серверные заголовки. Убедитесь, что в клиентских файлах нет включений `Server.h` или `Database.h`.

## Разработка

### Структура проекта
- **Сервер:** Многопоточный, обрабатывает подключения в отдельных потоках
- **Клиент:** Асинхронный прием сообщений в фоновом потоке
- **База данных:** Потокобезопасный доступ через мьютексы

### Сборка для разработки
```bash
# Debug сборка с отладочной информацией
cmake -B build -S . -DCMAKE_BUILD_TYPE=Debug
cmake --build build --config Debug
```

## Лицензия

MIT License
=======
Небольшой кроссплатформенный консольный чат (клиент/сервер) на C++ с хранением данных в SQLite.

- Клиент: консольное меню, приватные/общие сообщения, история, список пользователей
- Сервер: многопоточная обработка TCP‑соединений, маршрутизация сообщений, SQLite‑логирование
- Платформы: macOS, Linux, Windows (MSVC/MinGW)

## Возможности

- Регистрация и авторизация пользователей
- Общий чат (broadcast) и приватные сообщения
- История сообщений (общая и приватная)
- Список пользователей
- Информативные сообщения в консоли клиента и сервера

## Архитектура

- `src/chat_server_tcp/` — сервер (`Server.{h,cpp}`, `Database.{h,cpp}`, `server_main.cpp`)
- `src/chat_client_tcp/` — клиент (`Client.{h,cpp}`, `client_main.cpp`)
- `src/` — меню клиента (`Menu.cpp`) и общие утилиты (`common.*`)
- `include/` — общие заголовки
- `CMakeLists.txt` — корневой CMake (SQLite и ws2_32 для Windows)

## Зависимости

- C++17+
- CMake 3.10+
- SQLite3 (dev‑пакет)
  - macOS: `brew install sqlite`
  - Ubuntu/Debian: `sudo apt install libsqlite3-dev`
  - Windows (MSVC): `vcpkg install sqlite3` (или другая установка с CMake config)

## Сборка

### macOS / Linux
```bash
# 1) Клонирование
git clone <repo-url>
cd ConsoleChat

# 2) Генерация
cmake -B build -S . -DCMAKE_BUILD_TYPE=Release

# 3) Сборка
cmake --build build --config Release
```

### Windows (MSVC + vcpkg)
```bash
# Установите vcpkg и sqlite3
vcpkg install sqlite3

# Генерация проекта
cmake -B build -S . \
  -DCMAKE_TOOLCHAIN_FILE="<path-to-vcpkg>/scripts/buildsystems/vcpkg.cmake" \
  -DCMAKE_BUILD_TYPE=Release

# Сборка
cmake --build build --config Release
```
Если SQLite установлен иначе, убедитесь, что `find_package(SQLite3 REQUIRED)` находит пакет и предоставляет цель `SQLite::SQLite3`.

## Запуск

В каталоге сборки появятся:
- `tcp_chat_server` — сервер
- `tcp_chat_client` — клиент

1) Запустите сервер:
```bash
./tcp_chat_server
```
Сервер создаст базу `tcp_chat.db` (если её нет) и добавит `admin/admin123` при первом запуске.

2) Запустите клиент:
```bash
./tcp_chat_client
```

## Использование (клиент)

Главное меню:
- 1 — Вход
- 2 — Регистрация
- 3 — Выход

Меню пользователя:
- 1 — Приватный чат
- 2 — Общий чат
- 3 — История сообщений
- 4 — Список пользователей
- 5 — Выход (из аккаунта)

Команды в чате:
- `/exit` — вернуться в меню
- `/history` — показать историю (общую или приватную)
- `/users` — список пользователей (в общем чате)
- `/help` — показать команды
- `/quit` — выйти из приложения (в общем чате)

## Сеть

- Сервер слушает `0.0.0.0:12345`
- Клиент по умолчанию подключается к `127.0.0.1:12345` (см. `src/chat_client_tcp/client_main.cpp`)
- В клиенте настроен таймаут чтения для корректного выхода из аккаунта

## Частые проблемы

- CMake не находит SQLite3:
  - macOS: `brew install sqlite`
  - Linux: `sudo apt install libsqlite3-dev`
  - Windows: vcpkg (`vcpkg install sqlite3`) и `-DCMAKE_TOOLCHAIN_FILE`

- Клиент не может войти/зарегистрироваться:
  - Убедитесь, что сервер запущен и доступен по IP/порту
  - Проверьте брандмауэр/антивирус

## Разработка

- Простая многопоточность на сервере (`std::thread`, `recv`/`send`)
- Синхронизация (`std::mutex`) для списков клиентов
- Хранение пользователей/сообщений/логов в SQLite

## Лицензия

MIT
>>>>>>> e23fc9352f74e75d3361d0e92dcd2be2a34494bd
